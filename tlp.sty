\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{tlp}[2023/06/03 2.0 Traffic Light Protocol (TLP) stamps]
% Implements https://www.first.org/tlp/ stamps

\RequirePackage{xcolor}
\RequirePackage{xstring}

\RequirePackage{e3lists}

\listset{\Tlp@Level}{CLEAR}
\newcommand\tlp[1]{\listset{\Tlp@Level}{#1}}

\DeclareOption{RED}{\listset{\Tlp@Level}{RED}}
\DeclareOption{GREEN}{\listset{\Tlp@Level}{GREEN}}
\DeclareOption{AMBER}{\listset{\Tlp@Level}{AMBER}}
\DeclareOption{AMBER+STRICT}{\listset{\Tlp@Level}{AMBER+STRICT}}
\DeclareOption{CLEAR}{\listset{\Tlp@Level}{CLEAR}}

\DeclareOption{WHITE}{\listset{\Tlp@Level}{WHITE}} % Deprecated as of v2.0

\newif\ifTlp@LevelChr\Tlp@LevelChrfalse
\DeclareOption{CHR}{\Tlp@LevelChrtrue}

\ProcessOptions\relax

\ifTlp@LevelChr \listappend{\Tlp@Level}{CHR} \fi

\def\Tlp@Font{\sffamily\bfseries\large}
\newcommand\tlpfont[1]{\def\Tlp@Font{#1}}

\definecolor{TlpRed}{RGB}{255,43,43}
\definecolor{TlpAmber}{RGB}{255,192,0}
\definecolor{TlpGreen}{RGB}{51,255,0}
\definecolor{TlpClear}{RGB}{255,255,255}
\definecolor{TlpWhite}{RGB}{255,255,255}
\definecolor{TlpChr}{RGB}{0,192,244}

\newcommand\Tlp@Stamp[2]{%
    {%
        \Tlp@Font % Set font
        \setlength{\fboxsep}{\f@size pt} % Get current size font
        \setlength{\fboxsep}{0.5\fboxsep}% Keep half size font
        \colorbox{black}{\color{#1}#2}%
    }%
}

\newcommand\TLP[1]{%

    \IfEqCase*{#1}{%
        {RED}{\Tlp@Stamp{TlpRed}{TLP:RED}}%
        {AMBER}{\Tlp@Stamp{TlpAmber}{TLP:AMBER}}%
        {AMBER+STRICT}{\Tlp@Stamp{TlpAmber}{TLP:AMBER+STRICT}}%
        {GREEN}{\Tlp@Stamp{TlpGreen}{TLP:GREEN}}%
        {CLEAR}{\Tlp@Stamp{TlpClear}{TLP:CLEAR}}%
        {WHITE}{\Tlp@Stamp{TlpWhite}{TLP:WHITE} \PackageWarning{tlp}{As of v2.0 of the Traffic Light Protocol TLP:WHITE is deprecated !}}%
        {CHR}{\Tlp@Stamp{TlpChr}{TLP:EX:CHR}}%
    }[\PackageWarning{tlp}{Only RED, AMBER, AMBER+STRICT, GREEN, CLEAR, WHITE and CHR are defined, received '#1'}]%
    
}

\newcommand\tlpstamp{%
    \listprocess{\Tlp@Level}{\TLP{##1}}%
}